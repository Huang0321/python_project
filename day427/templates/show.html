<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ShowStudents</title>
    <script type="text/javascript" src="/static/js/jquery.min.js"></script>
    <script>
        $(function(){
           $('#show').click(function(){
               $.get('/stu/student/', function(msg) {
                   s = '<table><tr><td>ID</td><td>姓名</td><td>地址</td><td>操作</td></tr>';
                   msg_data = msg['data']['results'];
                   for(var i=0; i<msg_data.length; i++){
                       s += '<tr><td>'+ msg_data[i].id +'</td>\
                       <td>' + msg_data[i].s_name + '</td><td>'
                        + msg_data[i].s_tel + '</td>' +
                           '<td><a href="javascript:;" onclick="update_stu(' + msg_data[i].id +')">编辑</a> </td>' +
                           '<td><a href="javascript:;" onclick="del_stu(' + msg_data[i].id + ')">删除</a></td></tr>'
                   }
                   s += '</table>';
                   $('#data').html(s);
               }, 'json');
           });
           $('#create').click(function () {
               s = '姓名:<input type="text" id="s_name">' +
               '电话:<input type="text" id="s_tel">' +
               '<button onclick="add()">提交</button>';
               $('#new_stu').html(s)
           });
        });

        function del_stu(i){
            {#获取csrf的值#}
            csrf = $('input[name="csrfmiddlewaretoken"]').val;
            $.ajax({
                url:'/stu/student/' + i + '/',
                type: 'delete',
                headers: {'X-CSRFToken': csrf},
                dataType:'json',
                success: function(){
                    alert('删除成功');
                },
                error: function(){
                    alert('删除失败');
                }
            });
        }
        function update_stu(i){
            s = '姓名：<input id="s_name" type="text" name="name">'+
            '电话：<input id="s_tel" type="text" name="tel">' +
            '<input type="button" value="提交" onclick="update(' + i + ')">';
            $('#update_stu').html(s)
        }
        function update(i){
            csrf = $('input[name="csrfmiddlewaretoken"]').val();
            s_name = $('#s_name').val();
            s_tel = $('#s_tel').val();
            $.ajax({
                url:'/stu/student/'+ i + '/',
                type:'PATCH',
                data: {'s_name': s_name, 's_tel': s_tel},
                dataType: 'json',
                headers:{'X-CSRFToken': csrf},
                success: function(){
                    alert('修改成功')
                },
                error: function(){
                    alert('修改失败')
                }
            })
        }
        function add(){
            csrf = $('input[name="csrfmiddlewaretoken"]').val();
            s_name = $('#s_name').val();
            s_tel = $('#s_tel').val();
            $.ajax({
                url:'/stu/student/',
                type:'POST',
                data: {'s_name': s_name, 's_tel': s_tel},
                dataType: 'json',
                headers:{'X-CSRFToken': csrf},
                success: function(){
                    alert('添加成功')
                },
                error: function(){
                    alert('添加失败')
                }
            })

        }

    </script>
</head>
<body>
    {% csrf_token %}
    <button id="show">点我啊</button>
    <div id="data"></div>
    <div id="update_stu"></div>
    <button id="create">创建学生</button>
    <div id="new_stu"></div>
</body>
</html>